# AIsci æ™ºèƒ½ç—…å†ç”Ÿæˆç³»ç»Ÿ API & SDK

## ğŸ“‹ æ¦‚è¿°

AIsci API æœåŠ¡æ˜¯ä¸€ä¸ªåŸºäº FastAPI çš„é«˜æ€§èƒ½æ¥å£æœåŠ¡ï¼Œæä¾›è¯­éŸ³è½¬å½•ã€ç—…ä¾‹ç»“æ„åŒ–ã€ç—…å†ç”Ÿæˆä»¥åŠçµçŠ€å¼•æ“ï¼ˆLLMï¼‰å¯¹è¯åŠŸèƒ½ã€‚å®ƒä¸ä»…æ”¯æŒ Web/å°ç¨‹åºè°ƒç”¨ï¼Œè¿˜æä¾›äº† Python SDK æ–¹ä¾¿å…¶ä»–é¡¹ç›®ç›´æ¥é›†æˆã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. å¯åŠ¨æœåŠ¡

**Windows:**
```bash
python src/api_server.py
```

æœåŠ¡é»˜è®¤å°†åœ¨ `http://localhost:5000` å¯åŠ¨ï¼Œä½ å¯ä»¥è®¿é—® `http://localhost:5000/docs` æŸ¥çœ‹äº¤äº’å¼ Swagger æ–‡æ¡£ã€‚

---

## ğŸ“¦ SDK æ¥å…¥ (Python)

æˆ‘ä»¬æä¾›äº† `sdk.py`ï¼Œåªéœ€å‡ è¡Œä»£ç å³å¯æ¥å…¥ï¼š

```python
from sdk import AIsciClient

# åˆå§‹åŒ–å®¢æˆ·ç«¯ (é»˜è®¤åœ°å€ http://localhost:5000)
client = AIsciClient(base_url="http://localhost:5000")

# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
health = client.health_check()
print(health)

# 2. è¯­éŸ³è½¬å½•
# transcript_res = client.transcribe("path/to/audio.wav")
# transcript = transcript_res['data']['transcript']

# 3. ç—…ä¾‹ç»“æ„åŒ– (å¯¹è¯ -> ç»“æ„åŒ–æ•°æ®)
transcript = "åŒ»ç”Ÿï¼šä½ å¥½ã€‚æ‚£è€…ï¼šæˆ‘å¤´ç—›ã€‚"
structure_res = client.structure_case(transcript)
structured_data = structure_res['data']['structured_case']

# 4. ç—…å†æŠ¥å‘Šç”Ÿæˆ
report_res = client.generate_report(
    structured_case=structured_data,
    patient_info={"å§“å": "å¼ ä¸‰", "å¹´é¾„": "45"}
)
print(report_res['data']['medical_record'])
```

### å¼‚æ­¥æ”¯æŒ (å¯é€‰)
SDK å†…éƒ¨é›†æˆäº†åŸºäº `httpx` çš„å¼‚æ­¥å®¢æˆ·ç«¯ï¼š
```python
import asyncio
from sdk import AsyncAIsciClient

async def main():
    client = AsyncAIsciClient()
    res = await client.structure_case("æ‚£è€…ä¸»è¯‰...")
    print(res)

asyncio.run(main())
```

---

## ğŸ“¡ API æ¥å£

### åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:5000`
- **Swagger UI**: `/docs`
- **ReDoc**: `/redoc`

### æ ¸å¿ƒæ¥å£åˆ—è¡¨

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/health` | GET | å¥åº·æ£€æŸ¥ |
| `/api/chat` | POST | **çµçŠ€å¼•æ“å¯¹è¯** (æ–°) |
| `/api/transcribe` | POST | è¯­éŸ³è½¬å½• |
| `/api/structure` | POST | ç—…ä¾‹ç»“æ„åŒ– |
| `/api/generate` | POST | ç—…å†ç”Ÿæˆ |
| `/api/reset` | POST | é‡ç½®å¯¹è¯å†å² |

---

## ğŸ“– æ–‡æ¡£

- **[API æ–‡æ¡£](APIæ–‡æ¡£.md)** - è¯¦ç»†çš„ API æ¥å£æ–‡æ¡£
- **[å°ç¨‹åºé›†æˆæŒ‡å—](å°ç¨‹åºé›†æˆæŒ‡å—.md)** - å¾®ä¿¡å°ç¨‹åºé›†æˆæ•™ç¨‹
- **[ç½‘é¡µé›†æˆæŒ‡å—](ç½‘é¡µé›†æˆæŒ‡å—.md)** - ç½‘é¡µåº”ç”¨é›†æˆæ•™ç¨‹

---

## ğŸ”§ é…ç½®

### API é…ç½®

åœ¨ `api_server.py` ä¸­ä¿®æ”¹é…ç½®ï¼š

```python
app.run(host='0.0.0.0', port=5000, debug=True)
```

### API å¯†é’¥é…ç½®

åœ¨ `voice.py` ä¸­é…ç½®è®¯é£ API å¯†é’¥ï¼š

```python
APPID = "your_appid"
API_KEY = "your_api_key"
API_SECRET = "your_api_secret"
```

---

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
AIsci/
â”œâ”€â”€ api_server.py              # API æœåŠ¡ä¸»æ–‡ä»¶
â”œâ”€â”€ voice.py                   # è¯­éŸ³è¯†åˆ«æ¨¡å—
â”œâ”€â”€ nlp_processor.py           # NLP å¤„ç†æ¨¡å—
â”œâ”€â”€ case_structurer.py         # ç—…ä¾‹ç»“æ„åŒ–æ¨¡å—
â”œâ”€â”€ document_generator.py      # æ–‡æ¡£ç”Ÿæˆæ¨¡å—
â”œâ”€â”€ case_manager.py            # ç—…ä¾‹ç®¡ç†æ¨¡å—
â”œâ”€â”€ start_api.bat              # å¯åŠ¨è„šæœ¬ï¼ˆWindowsï¼‰
â”œâ”€â”€ test_api.py                # API æµ‹è¯•è„šæœ¬
â”œâ”€â”€ requirements.txt           # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ APIæ–‡æ¡£.md                 # API æ¥å£æ–‡æ¡£
â”œâ”€â”€ å°ç¨‹åºé›†æˆæŒ‡å—.md          # å°ç¨‹åºé›†æˆæ•™ç¨‹
â”œâ”€â”€ ç½‘é¡µé›†æˆæŒ‡å—.md            # ç½‘é¡µé›†æˆæ•™ç¨‹
â””â”€â”€ README_API.md              # æœ¬æ–‡ä»¶
```

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

âœ… **è¯­éŸ³è½¬å½•** - å®æ—¶è¯­éŸ³è½¬æ–‡å­—ï¼ˆåŒ»ç–—é¢†åŸŸä¼˜åŒ–ï¼‰
âœ… **ç—…ä¾‹ç»“æ„åŒ–** - è‡ªåŠ¨æå–ç—…ä¾‹ä¿¡æ¯
âœ… **è¯´è¯äººåŒºåˆ†** - åŒºåˆ†åŒ»ç”Ÿå’Œæ‚£è€…
âœ… **åŒ»å­¦æ–‡ä¹¦ç”Ÿæˆ** - ç”Ÿæˆæ ‡å‡†åŒ–ç—…å†
âœ… **æ•°æ®ç®¡ç†** - ä¿å­˜ã€åŠ è½½ã€åˆ é™¤ç—…ä¾‹
âœ… **Word å¯¼å‡º** - ç”Ÿæˆä¸“ä¸šç—…å†æ–‡æ¡£
âœ… **RESTful API** - æ ‡å‡†åŒ–æ¥å£è®¾è®¡
âœ… **CORS æ”¯æŒ** - è·¨åŸŸè¯·æ±‚æ”¯æŒ
âœ… **é”™è¯¯å¤„ç†** - å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶

### æŠ€æœ¯ç‰¹ç‚¹

âœ… **åŒ»ç–—é¢†åŸŸä¼˜åŒ–** - è®¯é£åŒ»ç–— API
âœ… **ä¸“ä¸šæœ¯è¯­å‡†ç¡®** - AI æ¨¡å‹ä¼˜åŒ–
âœ… **åŒ»å­¦æ–‡ä¹¦è§„èŒƒ** - ç¬¦åˆç—…å†ä¹¦å†™æ ‡å‡†
âœ… **è‡ªåŠ¨è¿‡æ»¤æ— å…³ä¿¡æ¯** - åªä¿ç•™åŒ»ç–—ç›¸å…³å†…å®¹
âœ… **é‡åŒ–æè¿°** - å‡†ç¡®è®°å½•æ•°å€¼æŒ‡æ ‡
âœ… **æ˜“äºé›†æˆ** - ç®€å•çš„ RESTful API
âœ… **è·¨å¹³å°æ”¯æŒ** - æ”¯æŒå°ç¨‹åºå’Œç½‘é¡µ

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### 1. å¥åº·æ£€æŸ¥

```bash
curl http://localhost:5000/health
```

### 2. è¯­éŸ³è½¬å½•

```bash
curl -X POST http://localhost:5000/api/transcribe \
  -H "Content-Type: application/json" \
  -d '{
    "audio_data": "base64_encoded_audio",
    "format": "wav"
  }'
```

### 3. ç—…ä¾‹ç»“æ„åŒ–

```bash
curl -X POST http://localhost:5000/api/structure \
  -H "Content-Type: application/json" \
  -d '{
    "transcript": "æ‚£è€…ä¸»è¯‰å¤´ç—›ä¸‰å¤©...",
    "separate_speakers": true
  }'
```

### 4. ç—…å†ç”Ÿæˆ

```bash
curl -X POST http://localhost:5000/api/generate \
  -H "Content-Type: application/json" \
  -d '{
    "structured_case": {...},
    "patient_info": {...},
    "doctor_info": {...}
  }'
```

---

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
python test_api.py
```

### æµ‹è¯•è¦†ç›–

- âœ… å¥åº·æ£€æŸ¥
- âœ… è¯­éŸ³è½¬å½•
- âœ… ç—…ä¾‹ç»“æ„åŒ–
- âœ… ç—…å†ç”Ÿæˆ
- âœ… ä¿å­˜ç—…ä¾‹
- âœ… è·å–ç—…ä¾‹
- âœ… ç—…ä¾‹åˆ—è¡¨
- âœ… åˆ é™¤ç—…ä¾‹

---

## ğŸš€ éƒ¨ç½²

### æœ¬åœ°éƒ¨ç½²

```bash
python api_server.py
```

### ç”Ÿäº§éƒ¨ç½²

#### ä½¿ç”¨ Gunicorn

```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 api_server:app
```

#### ä½¿ç”¨ Docker

```dockerfile
FROM python:3.9
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["gunicorn", "-w", "4", "-b", "0.0.0.0:5000", "api_server:app"]
```

#### ä½¿ç”¨ Nginx åå‘ä»£ç†

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®‰å…¨æ€§

1. **API å¯†é’¥ä¿æŠ¤**
   - ä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­æš´éœ² API å¯†é’¥
   - å»ºè®®åœ¨åç«¯æœåŠ¡ä¸­é…ç½® API å¯†é’¥

2. **HTTPS**
   - ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ HTTPS
   - é…ç½® SSL è¯ä¹¦

3. **è®¤è¯æˆæƒ**
   - æ·»åŠ  API è®¤è¯æœºåˆ¶
   - å®ç°ç”¨æˆ·æƒé™ç®¡ç†

### æ€§èƒ½ä¼˜åŒ–

1. **éŸ³é¢‘å¤„ç†**
   - é™åˆ¶éŸ³é¢‘æ–‡ä»¶å¤§å°
   - ä½¿ç”¨æµå¼å¤„ç†å¤§æ–‡ä»¶

2. **ç¼“å­˜**
   - ç¼“å­˜å¸¸ç”¨æ•°æ®
   - å‡å°‘é‡å¤è®¡ç®—

3. **è´Ÿè½½å‡è¡¡**
   - ä½¿ç”¨å¤šä¸ªæœåŠ¡å®ä¾‹
   - é…ç½®è´Ÿè½½å‡è¡¡å™¨

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å“åº”æ—¶é—´

- **å¥åº·æ£€æŸ¥**: < 100ms
- **è¯­éŸ³è½¬å½•**: 2-5sï¼ˆå–å†³äºéŸ³é¢‘é•¿åº¦ï¼‰
- **ç—…ä¾‹ç»“æ„åŒ–**: 2-5s
- **ç—…å†ç”Ÿæˆ**: 5-10s
- **æ–‡æ¡£å¯¼å‡º**: 1-3s

### å¹¶å‘å¤„ç†

- **æ¨èå¹¶å‘æ•°**: 10-20
- **æœ€å¤§å¹¶å‘æ•°**: 50
- **èµ„æºå ç”¨**: 200-500MB å†…å­˜

---

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### Q: æœåŠ¡æ— æ³•å¯åŠ¨ï¼Ÿ
**A:**
1. æ£€æŸ¥ç«¯å£ 5000 æ˜¯å¦è¢«å ç”¨
2. ç¡®è®¤ä¾èµ–å·²æ­£ç¡®å®‰è£…
3. æŸ¥çœ‹ Python ç‰ˆæœ¬ï¼ˆå»ºè®® 3.7+ï¼‰

#### Q: è¯­éŸ³è½¬å½•å¤±è´¥ï¼Ÿ
**A:**
1. æ£€æŸ¥è®¯é£ API å¯†é’¥é…ç½®
2. ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
3. æŸ¥çœ‹éŸ³é¢‘æ ¼å¼æ˜¯å¦æ­£ç¡®

#### Q: ç—…ä¾‹ç»“æ„åŒ–å¤±è´¥ï¼Ÿ
**A:**
1. ç¡®è®¤æ˜Ÿç« API å¯†é’¥é…ç½®
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—

#### Q: è·¨åŸŸè¯·æ±‚å¤±è´¥ï¼Ÿ
**A:**
1. ç¡®è®¤å·²å®‰è£… flask-cors
2. æ£€æŸ¥ CORS é…ç½®
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è·å–å¸®åŠ©

- **API æ–‡æ¡£**: [APIæ–‡æ¡£.md](APIæ–‡æ¡£.md)
- **å°ç¨‹åºé›†æˆ**: [å°ç¨‹åºé›†æˆæŒ‡å—.md](å°ç¨‹åºé›†æˆæŒ‡å—.md)
- **ç½‘é¡µé›†æˆ**: [ç½‘é¡µé›†æˆæŒ‡å—.md](ç½‘é¡µé›†æˆæŒ‡å—.md)
- **æµ‹è¯•è„šæœ¬**: test_api.py

### è”ç³»æ–¹å¼

- **GitHub Issues**: https://github.com/your-repo/aisci/issues
- **Email**: support@example.com

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ‰ æ€»ç»“

è¯­éŸ³è½¬ç—…ä¾‹åŠ©æ‰‹ API æœåŠ¡å·²æˆåŠŸå°è£…ä¸º RESTful APIï¼

**ä¸»è¦ç‰¹ç‚¹ï¼š**
- âœ… æ ‡å‡†åŒ– RESTful API æ¥å£
- âœ… æ”¯æŒå°ç¨‹åºå’Œç½‘é¡µé›†æˆ
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… CORS è·¨åŸŸæ”¯æŒ
- âœ… è¯¦ç»†çš„ API æ–‡æ¡£
- âœ… å®Œæ•´çš„é›†æˆæŒ‡å—
- âœ… æ˜“äºéƒ¨ç½²å’Œç»´æŠ¤

**ä½¿ç”¨å»ºè®®ï¼š**
1. é¦–æ¬¡ä½¿ç”¨è¯·ä»”ç»†é˜…è¯» API æ–‡æ¡£
2. é…ç½®æ­£ç¡®çš„ API å¯†é’¥
3. è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½
4. æ ¹æ®éœ€æ±‚é€‰æ‹©é›†æˆæ–¹å¼ï¼ˆå°ç¨‹åº/ç½‘é¡µï¼‰
5. ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ HTTPS

å¼€å§‹ä½¿ç”¨è¯­éŸ³è½¬ç—…ä¾‹åŠ©æ‰‹ API æœåŠ¡ï¼Œè½»æ¾é›†æˆè¯­éŸ³è½¬ç—…ä¾‹åŠŸèƒ½ï¼ğŸš€
